<!DOCTYPE html>
<!-- saved from url=(0012)about:srcdoc -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.13/html-to-image.min.js" integrity="sha512-iZ2ORl595Wx6miw+GuadDet4WQbdSWS3JLMoNfY8cRGoEFy6oT3G9IbcrBeL6AfkgpA51ETt/faX6yLV+/gFJg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
      (function() {
        const originalConsole = window.console;
        window.console = {
          log: (...args) => {
            originalConsole.log(...args);
            window.parent.postMessage({ type: 'console', message: args.join(' ') }, '*');
          },
          error: (...args) => {
            originalConsole.error(...args);
            window.parent.postMessage({ type: 'console', message: 'Error: ' + args.join(' ') }, '*');
          },
          warn: (...args) => {
            originalConsole.warn(...args);
            window.parent.postMessage({ type: 'console', message: 'Warning: ' + args.join(' ') }, '*');
          }
        };

        let requestId = 0;
        let callbacksMap = new Map();
        let streamControllers = new Map();
        
        window.claude = {
          complete: (prompt) => {
            return new Promise((resolve, reject) => {
              const id = requestId++;
              callbacksMap.set(id, { resolve, reject });
              window.parent.postMessage({ type: 'claudeComplete', id, prompt }, '*');
            });
          }
        };

        window.storage = {
          get: (key, shared = false) => {
            return new Promise((resolve, reject) => {
              const id = requestId++;
              callbacksMap.set(id, { resolve, reject });
              window.parent.postMessage({ type: 'storageGet', id, key, shared }, '*');
            });
          },
          set: (key, value, shared = false) => {
            return new Promise((resolve, reject) => {
              const id = requestId++;
              callbacksMap.set(id, { resolve, reject });
              window.parent.postMessage({ type: 'storageSet', id, key, value, shared }, '*');
            });
          },
          delete: (key, shared = false) => {
            return new Promise((resolve, reject) => {
              const id = requestId++;
              callbacksMap.set(id, { resolve, reject });
              window.parent.postMessage({ type: 'storageDelete', id, key, shared }, '*');
            });
          },
          list: (prefix, shared = false) => {
            return new Promise((resolve, reject) => {
              const id = requestId++;
              callbacksMap.set(id, { resolve, reject });
              window.parent.postMessage({ type: 'storageList', id, prefix, shared }, '*');
            });
          }
        };

        let pendingBlobs = new Map();
        URL.createObjectURL = (blob) => {
          // Store the blob and create an ID and URL for it
          const blobId = `blob-${Date.now()}-${Math.random()}`;
          pendingBlobs.set(blobId, blob);
          return `blob-request://${blobId}`;
        };

        URL.revokeObjectURL = (url) => {
          // Remove the blob from our store
          const blobId = url.replace("blob-request://", "");
          pendingBlobs.delete(blobId);
        };

        const getBlobFromURL = (url) => {
          const blobId = url.replace("blob-request://", "");
          return pendingBlobs.get(blobId);
        };

        // Override global fetch with streaming support
        window.fetch = (url, init = {}) => {
          return new Promise((resolve, reject) => {
            const id = requestId++;
            const channelId = `fetch-${id}-${Date.now()}`;
            
            callbacksMap.set(id, { 
              resolve: (response) => {
                // Create a ReadableStream for the response body
                const stream = new ReadableStream({
                  start(controller) {
                    streamControllers.set(channelId, controller);
                  },
                  cancel() {
                    streamControllers.delete(channelId);
                  }
                });
                
                // Create and return the Response with the stream
                resolve(new Response(stream, {
                  status: response.status,
                  statusText: response.statusText,
                  headers: response.headers
                }));
              },
              reject,
              channelId
            });
            
            window.parent.postMessage({
              type: 'proxyFetch',
              id,
              url,
              init,
              channelId
            }, '*');
          });
        };

        window.addEventListener('message', async (event) => {
          if (event.data.type === 'takeScreenshot') {
            const rootElement = document.getElementById('artifacts-component-root-html');
            if (!rootElement) {
              window.parent.postMessage({
                type: 'screenshotError',
                error: new Error('Root element not found'),
              }, '*');
            }
            const screenshot = await htmlToImage.toPng(rootElement, {
              imagePlaceholder:
                "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAA1JREFUGFdjePDgwX8ACOQDoNsk0PMAAAAASUVORK5CYII=",
            });
            window.parent.postMessage({
              type: 'screenshotData',
              data: screenshot,
            }, '*');
          } else if (event.data.type === 'claudeComplete') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
            } else {
              callback.resolve(event.data.completion);
            }
            callbacksMap.delete(event.data.id);
          } else if (event.data.type === 'proxyFetchResponse') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
              callbacksMap.delete(event.data.id);
            } else {
              // Initial response with headers, status, etc.
              callback.resolve({
                status: event.data.status,
                statusText: event.data.statusText,
                headers: event.data.headers
              });
              // Don't delete the callback yet if streaming
              if (!event.data.body) {
                callbacksMap.delete(event.data.id);
              }
            }
          } else if (event.data.type === 'proxyFetchStream') {
            // Handle streaming data chunks
            const controller = streamControllers.get(event.data.channelId);
            if (controller) {
              if (event.data.error) {
                controller.error(new Error(event.data.error));
                streamControllers.delete(event.data.channelId);
              } else if (event.data.done) {
                controller.close();
                streamControllers.delete(event.data.channelId);
                // Clean up the callback
                const callback = Array.from(callbacksMap.entries()).find(
                  ([_, value]) => value.channelId === event.data.channelId
                );
                if (callback) {
                  callbacksMap.delete(callback[0]);
                }
              } else if (event.data.chunk) {
                controller.enqueue(new Uint8Array(event.data.chunk));
              }
            }
          } else if (event.data.type === 'storageGet') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
            } else {
              callback.resolve(event.data.result);
            }
            callbacksMap.delete(event.data.id);
          } else if (event.data.type === 'storageSet') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
            } else {
              callback.resolve(event.data.result);
            }
            callbacksMap.delete(event.data.id);
          } else if (event.data.type === 'storageDelete') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
            } else {
              callback.resolve(event.data.result);
            }
            callbacksMap.delete(event.data.id);
          } else if (event.data.type === 'storageList') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
            } else {
              callback.resolve(event.data.result);
            }
            callbacksMap.delete(event.data.id);
          }
        });

        window.addEventListener('click', (event) => {
          const isEl = event.target instanceof HTMLElement;
          if (!isEl) return;
    
          // find ancestor links
          const linkEl = event.target.closest("a");
          if (!linkEl || !linkEl.href) return;
    
          event.preventDefault();
          event.stopImmediatePropagation();
    
          if (linkEl.href.startsWith("blob-request:")) {
            const blob = getBlobFromURL(linkEl.href);
            if (!blob) return;
            void blob.arrayBuffer().then((data) => {
              window.parent.postMessage({
                type: "downloadFile",
                filename: linkEl.download,
                data,
                mimeType: blob.type || "application/octet-stream",
              });
            });
          } else if (linkEl.href.startsWith("data:")) {
            const [header, base64Data] = linkEl.href.split(",");
            const mimeMatch = header.match(/data:([^;]+)/);
            const mimeType = mimeMatch ? mimeMatch[1] : "application/octet-stream";
            const binaryString = atob(base64Data);
            const data = Uint8Array.from(binaryString, (c) =>
              c.charCodeAt(0),
            ).buffer;
            window.parent.postMessage({
              type: "downloadFile",
              filename: linkEl.download,
              data,
              mimeType,
            });
          } else {
            let linkUrl;
            try {
              linkUrl = new URL(linkEl.href);
            } catch (error) {
              return;
            }
    
            if (linkUrl.hostname === window.location.hostname) return;
      
            window.parent.postMessage({
              type: 'openExternal',
              href: linkEl.href,
            }, '*');
          }
      });

        const originalOpen = window.open;
        window.open = function (url) {
          window.parent.postMessage({
            type: "openExternal",
            href: url,
          }, "*");
        };

        window.addEventListener('error', (event) => {
          window.parent.postMessage({ type: 'console', message: 'Uncaught Error: ' + event.message }, '*');
        });
      })();
    </script>
  
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christmas Gift Exchange</title>
    <script crossorigin="" src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin="" src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com/"></script>
</head>
<body id="artifacts-component-root-html" data-new-gr-c-s-check-loaded="14.1258.0" data-gr-ext-installed="">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide icons as SVG components
        const Gift = () => (
            <svg className="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" />
            </svg>
        );

        const Users = () => (
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
        );

        const Settings = () => (
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        );

        const Play = () => (
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const Copy = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
        );

        const Check = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
            </svg>
        );

        const Database = () => (
            <svg className="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4" />
            </svg>
        );

        function GiftExchange() {
            const [mode, setMode] = useState('setup');
            const [participants, setParticipants] = useState([]);
            const [restrictions, setRestrictions] = useState({});
            const [newName, setNewName] = useState('');
            const [newGender, setNewGender] = useState('male');
            const [selectedPerson, setSelectedPerson] = useState('');
            const [result, setResult] = useState(null);
            const [alreadySelected, setAlreadySelected] = useState([]);
            const [alreadyPicked, setAlreadyPicked] = useState([]);
            const [shareLink, setShareLink] = useState('');
            const [copied, setCopied] = useState(false);
            const [exchangeId, setExchangeId] = useState('');
            const [firebaseConfig, setFirebaseConfig] = useState({
                apiKey: '',
                authDomain: '',
                databaseURL: '',
                projectId: '',
                storageBucket: '',
                messagingSenderId: '',
                appId: ''
            });
            const [firebaseConfigured, setFirebaseConfigured] = useState(false);
            const [showConfig, setShowConfig] = useState(false);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            useEffect(() => {
                const stored = localStorage.getItem('firebaseConfig');
                if (stored) {
                    try {
                        const config = JSON.parse(stored);
                        setFirebaseConfig(config);
                        setFirebaseConfigured(true);
                        checkForExchangeId();
                    } catch (e) {
                        console.error('Failed to load Firebase config');
                    }
                }
            }, []);

            const checkForExchangeId = () => {
                const params = new URLSearchParams(window.location.search);
                const id = params.get('exchange');
                if (id) {
                    setExchangeId(id);
                    loadExchangeData(id);
                }
            };

            const saveFirebaseConfig = () => {
                localStorage.setItem('firebaseConfig', JSON.stringify(firebaseConfig));
                setFirebaseConfigured(true);
                setShowConfig(false);
                checkForExchangeId();
            };

            const generateExchangeId = () => {
                return 'exchange_' + Math.random().toString(36).substr(2, 9) + Date.now().toString(36);
            };

            const saveToFirebase = async (id, data) => {
                if (!firebaseConfigured) return;
                
                setLoading(true);
                setError('');
                
                try {
                    const response = await fetch(`${firebaseConfig.databaseURL}/exchanges/${id}.json`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });

                    if (!response.ok) {
                        throw new Error('Failed to save data');
                    }
                    
                    setLoading(false);
                } catch (e) {
                    setError('Failed to save to Firebase: ' + e.message);
                    setLoading(false);
                }
            };

            const loadExchangeData = async (id) => {
                if (!firebaseConfigured) return;
                
                setLoading(true);
                setError('');
                
                try {
                    const response = await fetch(`${firebaseConfig.databaseURL}/exchanges/${id}.json`);
                    
                    if (!response.ok) {
                        throw new Error('Failed to load data');
                    }
                    
                    const data = await response.json();
                    
                    if (data) {
                        setParticipants(data.participants || []);
                        setRestrictions(data.restrictions || {});
                        setAlreadySelected(data.alreadySelected || []);
                        setAlreadyPicked(data.alreadyPicked || []);
                        setMode('select');
                    }
                    
                    setLoading(false);
                } catch (e) {
                    setError('Failed to load from Firebase: ' + e.message);
                    setLoading(false);
                }
            };

            const addParticipant = () => {
                if (newName.trim()) {
                    setParticipants([...participants, { 
                        name: newName.trim(), 
                        gender: newGender,
                        emoji: newGender === 'male' ? '🎅' : '🤶'
                    }]);
                    setNewName('');
                    setNewGender('male');
                }
            };

            const removeParticipant = (index) => {
                const newParticipants = participants.filter((_, i) => i !== index);
                setParticipants(newParticipants);
                
                const name = participants[index].name;
                const newRestrictions = { ...restrictions };
                delete newRestrictions[name];
                Object.keys(newRestrictions).forEach(key => {
                    newRestrictions[key] = newRestrictions[key].filter(n => n !== name);
                });
                setRestrictions(newRestrictions);
            };

            const toggleRestriction = (giver, receiver) => {
                const newRestrictions = { ...restrictions };
                if (!newRestrictions[giver]) {
                    newRestrictions[giver] = [];
                }
                
                if (newRestrictions[giver].includes(receiver)) {
                    newRestrictions[giver] = newRestrictions[giver].filter(n => n !== receiver);
                } else {
                    newRestrictions[giver].push(receiver);
                }
                
                setRestrictions(newRestrictions);
            };

            const generateShareLink = async () => {
                const id = generateExchangeId();
                setExchangeId(id);
                
                const data = {
                    participants,
                    restrictions,
                    alreadySelected: [],
                    alreadyPicked: []
                };
                
                await saveToFirebase(id, data);
                
                const link = `${window.location.href.split('?')[0]}?exchange=${id}`;
                setShareLink(link);
            };

            const copyLink = () => {
                navigator.clipboard.writeText(shareLink);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            const runSelection = async () => {
                if (!selectedPerson) return;

                if (alreadyPicked.includes(selectedPerson)) {
                    setResult({ error: 'You have already made your selection!' });
                    return;
                }

                const available = participants
                    .map(p => p.name)
                    .filter(name => 
                        name !== selectedPerson && 
                        !alreadySelected.includes(name) &&
                        !(restrictions[selectedPerson] || []).includes(name)
                    );

                if (available.length === 0) {
                    setResult({ error: 'No available recipients!' });
                    return;
                }

                const randomIndex = Math.floor(Math.random() * available.length);
                const selected = available[randomIndex];
                
                const newAlreadySelected = [...alreadySelected, selected];
                const newAlreadyPicked = [...alreadyPicked, selectedPerson];
                
                setResult({ name: selected, emoji: participants.find(p => p.name === selected)?.emoji });
                setAlreadySelected(newAlreadySelected);
                setAlreadyPicked(newAlreadyPicked);
                
                if (exchangeId) {
                    await saveToFirebase(exchangeId, {
                        participants,
                        restrictions,
                        alreadySelected: newAlreadySelected,
                        alreadyPicked: newAlreadyPicked
                    });
                }
            };

            const resetSelection = () => {
                setSelectedPerson('');
                setResult(null);
            };

            if (!firebaseConfigured) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-red-700 via-green-700 to-red-800 p-8">
                        <div className="max-w-2xl mx-auto">
                            <div className="bg-white rounded-2xl shadow-2xl p-8">
                                <div className="flex items-center gap-3 mb-6">
                                    <Database />
                                    <h1 className="text-3xl font-bold text-green-800">Firebase Configuration Required</h1>
                                </div>
                                
                                <div className="mb-6 p-4 bg-blue-50 rounded-lg border-2 border-blue-300">
                                    <h2 className="font-semibold text-lg mb-2">Setup Instructions:</h2>
                                    <ol className="list-decimal list-inside space-y-2 text-sm">
                                        <li>Go to <a href="https://console.firebase.google.com/" target="_blank" rel="noopener noreferrer" className="text-blue-600 underline">Firebase Console</a></li>
                                        <li>Create a new project (or use existing)</li>
                                        <li>Go to Project Settings → General</li>
                                        <li>Scroll down to "Your apps" and click "Web app" (&lt;/&gt; icon)</li>
                                        <li>Copy the Firebase configuration values below</li>
                                        <li>In Firebase Console, go to Realtime Database → Create Database</li>
                                        <li>Choose "Start in test mode" for now</li>
                                    </ol>
                                </div>

                                <div className="space-y-4">
                                    <input
                                        type="text"
                                        placeholder="API Key"
                                        value={firebaseConfig.apiKey}
                                        onChange={(e) => setFirebaseConfig({...firebaseConfig, apiKey: e.target.value})}
                                        className="w-full px-4 py-2 border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500"
                                    />
                                    <input
                                        type="text"
                                        placeholder="Auth Domain"
                                        value={firebaseConfig.authDomain}
                                        onChange={(e) => setFirebaseConfig({...firebaseConfig, authDomain: e.target.value})}
                                        className="w-full px-4 py-2 border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500"
                                    />
                                    <input
                                        type="text"
                                        placeholder="Database URL (e.g., https://your-project.firebaseio.com)"
                                        value={firebaseConfig.databaseURL}
                                        onChange={(e) => setFirebaseConfig({...firebaseConfig, databaseURL: e.target.value})}
                                        className="w-full px-4 py-2 border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500"
                                    />
                                    <input
                                        type="text"
                                        placeholder="Project ID"
                                        value={firebaseConfig.projectId}
                                        onChange={(e) => setFirebaseConfig({...firebaseConfig, projectId: e.target.value})}
                                        className="w-full px-4 py-2 border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500"
                                    />
                                    <input
                                        type="text"
                                        placeholder="Storage Bucket"
                                        value={firebaseConfig.storageBucket}
                                        onChange={(e) => setFirebaseConfig({...firebaseConfig, storageBucket: e.target.value})}
                                        className="w-full px-4 py-2 border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500"
                                    />
                                    <input
                                        type="text"
                                        placeholder="Messaging Sender ID"
                                        value={firebaseConfig.messagingSenderId}
                                        onChange={(e) => setFirebaseConfig({...firebaseConfig, messagingSenderId: e.target.value})}
                                        className="w-full px-4 py-2 border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500"
                                    />
                                    <input
                                        type="text"
                                        placeholder="App ID"
                                        value={firebaseConfig.appId}
                                        onChange={(e) => setFirebaseConfig({...firebaseConfig, appId: e.target.value})}
                                        className="w-full px-4 py-2 border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500"
                                    />
                                    
                                    <button
                                        onClick={saveFirebaseConfig}
                                        className="w-full py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700"
                                    >
                                        Save Configuration
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-red-700 via-green-700 to-red-800 p-8 flex items-center justify-center">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 text-center">
                            <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-green-600 mx-auto mb-4"></div>
                            <p className="text-xl font-semibold text-gray-700">Loading...</p>
                        </div>
                    </div>
                );
            }

            if (mode === 'setup') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-red-700 via-green-700 to-red-800 p-8">
                        <div className="max-w-6xl mx-auto">
                            <div className="bg-white rounded-2xl shadow-2xl p-8">
                                <div className="flex items-center justify-between mb-8">
                                    <div className="flex items-center gap-3">
                                        <Gift />
                                        <h1 className="text-4xl font-bold text-green-800">Christmas Gift Exchange Setup</h1>
                                    </div>
                                    <button
                                        onClick={() => setShowConfig(!showConfig)}
                                        className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 flex items-center gap-2"
                                    >
                                        <Database />
                                        Firebase Config
                                    </button>
                                </div>

                                {showConfig && (
                                    <div className="mb-6 p-4 bg-gray-50 rounded-lg">
                                        <p className="text-sm text-gray-600 mb-2">Current Firebase Project: <strong>{firebaseConfig.projectId}</strong></p>
                                        <button
                                            onClick={() => {
                                                localStorage.removeItem('firebaseConfig');
                                                setFirebaseConfigured(false);
                                            }}
                                            className="text-sm text-red-600 hover:text-red-800"
                                        >
                                            Reset Configuration
                                        </button>
                                    </div>
                                )}

                                {error && (
                                    <div className="mb-6 p-4 bg-red-100 border-2 border-red-300 rounded-lg">
                                        <p className="text-red-800">{error}</p>
                                    </div>
                                )}

                                <div className="mb-8 p-6 bg-green-50 rounded-xl">
                                    <h2 className="text-2xl font-semibold text-green-800 mb-4 flex items-center gap-2">
                                        <Users />
                                        Add Participants
                                    </h2>
                                    <div className="flex gap-3 mb-4">
                                        <input
                                            type="text"
                                            placeholder="Name"
                                            value={newName}
                                            onChange={(e) => setNewName(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && addParticipant()}
                                            className="flex-1 px-4 py-2 border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500"
                                        />
                                        <select
                                            value={newGender}
                                            onChange={(e) => setNewGender(e.target.value)}
                                            className="px-4 py-2 border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500"
                                        >
                                            <option value="male">🎅 Male</option>
                                            <option value="female">🤶 Female</option>
                                        </select>
                                        <button
                                            onClick={addParticipant}
                                            className="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold"
                                        >
                                            Add
                                        </button>
                                    </div>

                                    <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                        {participants.map((p, i) => (
                                            <div key={i} className="bg-white p-4 rounded-lg shadow flex flex-col items-center gap-2">
                                                <div className="text-4xl">{p.emoji}</div>
                                                <div className="font-semibold text-center">{p.name}</div>
                                                <button
                                                    onClick={() => removeParticipant(i)}
                                                    className="text-xs text-red-600 hover:text-red-800"
                                                >
                                                    Remove
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {participants.length > 0 && (
                                    <div className="mb-8 p-6 bg-red-50 rounded-xl">
                                        <h2 className="text-2xl font-semibold text-red-800 mb-4 flex items-center gap-2">
                                            <Settings />
                                            Set Restrictions (Who can't select who)
                                        </h2>
                                        <div className="overflow-x-auto">
                                            <table className="w-full border-collapse">
                                                <thead>
                                                    <tr>
                                                        <th className="border-2 border-red-200 p-3 bg-red-100">Giver →<br/>Can't Get ↓</th>
                                                        {participants.map((p, i) => (
                                                            <th key={i} className="border-2 border-red-200 p-3 bg-red-100 text-sm">
                                                                <div className="text-2xl mb-1">{p.emoji}</div>
                                                                {p.name}
                                                            </th>
                                                        ))}
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {participants.map((receiver, ri) => (
                                                        <tr key={ri}>
                                                            <td className="border-2 border-red-200 p-3 bg-red-100 font-semibold">
                                                                <div className="text-2xl mb-1">{receiver.emoji}</div>
                                                                {receiver.name}
                                                            </td>
                                                            {participants.map((giver, gi) => (
                                                                <td key={gi} className="border-2 border-red-200 p-3 text-center">
                                                                    {giver.name !== receiver.name && (
                                                                        <input
                                                                            type="checkbox"
                                                                            checked={(restrictions[giver.name] || []).includes(receiver.name)}
                                                                            onChange={() => toggleRestriction(giver.name, receiver.name)}
                                                                            className="w-5 h-5 cursor-pointer"
                                                                        />
                                                                    )}
                                                                </td>
                                                            ))}
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                )}

                                {participants.length > 0 && (
                                    <div className="flex flex-col gap-4">
                                        <button
                                            onClick={generateShareLink}
                                            className="w-full py-4 bg-gradient-to-r from-red-600 to-green-600 text-white rounded-xl font-bold text-lg hover:from-red-700 hover:to-green-700 flex items-center justify-center gap-2"
                                        >
                                            <Copy />
                                            Generate Share Link
                                        </button>
                                        
                                        {shareLink && (
                                            <div className="p-4 bg-yellow-50 rounded-lg border-2 border-yellow-300">
                                                <p className="font-semibold mb-2">Share this link with participants:</p>
                                                <div className="flex gap-2">
                                                    <input
                                                        type="text"
                                                        value={shareLink}
                                                        readOnly
                                                        className="flex-1 px-3 py-2 bg-white border rounded"
                                                    />
                                                    <button
                                                        onClick={copyLink}
                                                        className="px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 flex items-center gap-2"
                                                    >
                                                        {copied ? <Check /> : <Copy />}
                                                        {copied ? 'Copied!' : 'Copy'}
                                                    </button>
                                                </div>
                                            </div>
                                        )}

                                        <button
                                            onClick={() => setMode('select')}
                                            className="w-full py-3 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700"
                                        >
                                            Go to Selection Mode
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-red-700 via-green-700 to-red-800 p-8">
                    <div className="max-w-2xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-2xl p-8">
                            <div className="text-center mb-8">
                                <Gift />
                                <h1 className="text-4xl font-bold text-green-800 mb-2">🎄 Secret Santa 🎄</h1>
                                <p className="text-gray-600">Select your name and discover your gift recipient!</p>
                            </div>

                            {!result ? (
                                <div className="space-y-6">
                                    <div>
                                        <label className="block text-lg font-semibold text-gray-700 mb-3">Who are you?</label>
                                        <select
                                            value={selectedPerson}
                                            onChange={(e) => setSelectedPerson(e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-green-300 rounded-lg text-lg focus:outline-none focus:border-green-500"
                                        >
                                            <option value="">-- Select Your Name --</option>
                                            {participants.map((p, i) => (
                                                <option 
                                                    key={i} 
                                                    value={p.name}
                                                    disabled={alreadyPicked.includes(p.name)}
                                                    style={alreadyPicked.includes(p.name) ? { textDecoration: 'line-through', color: '#999' } : {}}
                                                >
                                                    {p.emoji} {p.name}
                                                </option>
                                            ))}
                                        </select>
                                    </div>

                                    <button
                                        onClick={runSelection}
                                        disabled={!selectedPerson}
                                        className="w-full py-4 bg-gradient-to-r from-red-600 to-green-600 text-white rounded-xl font-bold text-xl hover:from-red-700 hover:to-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3"
                                    >
                                        <Play />
                                        Reveal Your Match!
                                    </button>

                                    <button
                                        onClick={() => setMode('setup')}
                                        className="w-full py-2 text-gray-600 hover:text-gray-800 text-sm"
                                    >
                                        Back to Setup
                                    </button>
                                </div>
                            ) : (
                                <div className="text-center space-y-6">
                                    {result.error ? (
                                        <>
                                            <div className="p-6 bg-red-100 rounded-xl">
                                                <p className="text-xl font-semibold text-red-800">{result.error}</p>
                                            </div>
                                            <button
                                                onClick={resetSelection}
                                                className="w-full py-3 bg-gray-600 text-white rounded-xl font-semibold hover:bg-gray-700"
                                            >
                                                Back
                                            </button>
                                        </>
                                    ) : (
                                        <>
                                            <div className="p-8 bg-gradient-to-br from-green-100 to-red-100 rounded-xl">
                                                <p className="text-2xl font-semibold text-gray-700 mb-4">
                                                    {selectedPerson}, you're buying a gift for:
                                                </p>
                                                <div className="text-8xl mb-4">{result.emoji}</div>
                                                <p className="text-4xl font-bold text-green-800">{result.name}</p>
                                            </div>
                                            <p className="text-sm text-gray-600">🤫 Remember, it's a secret!</p>
                                            <button
                                                onClick={resetSelection}
                                                className="w-full py-3 bg-gray-600 text-white rounded-xl font-semibold hover:bg-gray-700"
                                            >
                                                Done (Next Person)
                                            </button>
                                        </>
                                    )}
                                </div>
                            )}

                            {alreadyPicked.length > 0 && (
                                <div className="mt-8 p-4 bg-gray-100 rounded-lg">
                                    <p className="text-sm text-gray-600 font-semibold mb-2">Already Made Selection ({alreadyPicked.length}):</p>
                                    <div className="flex flex-wrap gap-2">
                                        {alreadyPicked.map((name, i) => (
                                            <span key={i} className="px-3 py-1 bg-gray-300 rounded-full text-sm">
                                                {participants.find(p => p.name === name)?.emoji} {name}
                                            </span>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<GiftExchange />, document.getElementById('root'));
    </script>

</body><grammarly-desktop-integration data-grammarly-shadow-root="true"><template shadowrootmode="open"><style>
      div.grammarly-desktop-integration {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select:none;
        user-select:none;
      }

      div.grammarly-desktop-integration:before {
        content: attr(data-content);
      }
    </style><div aria-label="grammarly-integration" role="group" tabindex="-1" class="grammarly-desktop-integration" data-content="{&quot;mode&quot;:&quot;full&quot;,&quot;isActive&quot;:true,&quot;isUserDisabled&quot;:false}"></div></template></grammarly-desktop-integration></html>